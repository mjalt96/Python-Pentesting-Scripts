import socket
import sys
from datetime import datetime

#handle arguments to define target
if len(sys.argv) <= 2:
    print("You need to specify a single port (e.g. 80), multiple ports (e.g. 21, 22, 80) , or a port range (e.g. 1-65535).")
    aux = input("Range: ")

    if aux.isdigit() == False and (aux.find("-") == -1 and aux.find(",") == -1):
            print("You need to specify a single port (e.g. 80), multiple ports (e.g. 21, 22, 80) , or a port range (e.g. 1-65535).")
            sys.exit(0)
    else:
        port = aux

    if len(sys.argv) == 1:
        host = input("You need to specify an IP address or hostname: ")
        host = socket.gethostbyname(host)
    else:
        host = socket.gethostbyname(sys.argv[1])
else:
    if sys.argv[2].isdigit() == False:
        if sys.argv[2].find("-") != 1 or sys.argv[2].find(",") != 1:
            host = socket.gethostbyname(sys.argv[1])
            port = sys.argv[2] 
        else:
            sys.exit(0)
    else:
        host = socket.gethostbyname(sys.argv[1])
        port = sys.argv[2] 

#add banner
print("-" * 50)
print("Scanning target: " + host)
print("Time initiated: " + str(datetime.now()))

#handling scan
try:
	if port.isdigit():
	    #single port scan
	    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	    sock.settimeout(0.5)
	    res = sock.connect_ex((host,int(port)))
	    if res == 0:
	        print("Open port: ", port)
	    sock.close()
	elif port.find("-") != -1:
	    #port range scan
	    aux = port.split('-')
	    for p in range(int(aux[0]),int(aux[1])):
	        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	        sock.settimeout(0.1) #100 milisenconds
	        res = sock.connect_ex((host, p))
	        if res == 0:
	            print("Open port: ", p)
	        sock.close()
	else:
	    #port list scan
	    aux = port.split(',')
	    for p in aux:
	        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	        sock.settimeout(0.3) #300 milisenconds
	        res = sock.connect_ex((host, int(p.strip())))
	        if res == 0:
	            print("Open port: ", p)
	        sock.close()
except KeyboardInterrupt:
	print("\n\nScan interrupted by keyboard.")
	sys.exit(0)
except socket.gaierror:
	print("\nHostname could not be resolved.")
	sys.exit(1)
except socket.error:
	print("\nCouldn't connect to target.")
	sys.exit(1)
except:
	print("\nUnknown exception.") 
	sys.exit(1)